<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGIY POS ELITE ‚Äî Royal Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --gold: #fbbf24; --gold-dark: #d97706;
            --bg: #0f172a; --card: #1e293b;
            --text: #f8fafc; --muted: #94a3b8;
            --glass: rgba(255, 255, 255, 0.03);
            --gradient: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', sans-serif; }
        
        body { 
            background: var(--bg); 
            background-image: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: var(--text); 
            min-height: 100vh;
        }

        /* Verrouillage Royal */
        #lockScreen { 
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.98); 
            backdrop-filter: blur(20px); z-index: 10000; display: none;
            align-items: center; justify-content: center; 
        }
        .lock-box { 
            background: var(--card); padding: 40px; border-radius: 30px; 
            border: 1px solid var(--gold); text-align: center; width: 90%; max-width: 400px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), 0 0 20px rgba(251, 191, 36, 0.2);
        }

        /* Header Noble */
        .header { 
            padding: 25px; background: var(--glass); border-bottom: 1px solid rgba(251, 191, 36, 0.2);
            display: flex; justify-content: space-between; align-items: center;
        }
        .brand { display: flex; align-items: center; gap: 15px; }
        .crown-icon { 
            width: 50px; height: 50px; background: var(--gradient); 
            border-radius: 15px; display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: #000; box-shadow: 0 10px 20px rgba(217, 119, 6, 0.3);
        }

        /* Navigation */
        .nav-elite { display: flex; gap: 15px; padding: 20px; overflow-x: auto; scrollbar-width: none; }
        .nav-link { 
            padding: 14px 28px; background: var(--card); border-radius: 16px; 
            color: var(--muted); cursor: pointer; border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s; font-weight: 600; font-size: 14px; white-space: nowrap;
        }
        .nav-link.active { 
            background: var(--gradient); color: #000; border-color: var(--gold);
            box-shadow: 0 10px 20px rgba(217, 119, 6, 0.2);
        }

        /* Grille & Layout */
        .main-container { padding: 20px; display: grid; grid-template-columns: 1fr 400px; gap: 25px; }
        @media (max-width: 1100px) { .main-container { grid-template-columns: 1fr; } }

        .products-listing { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .noble-card { 
            background: var(--card); padding: 25px; border-radius: 24px; text-align: center;
            border: 1px solid rgba(255,255,255,0.05); transition: 0.4s; cursor: pointer;
        }
        .noble-card:hover { transform: translateY(-10px); border-color: var(--gold); }
        .noble-card i { font-size: 35px; color: var(--gold); margin-bottom: 15px; display: block; }
        .p-name { font-weight: 700; font-size: 1.1rem; margin-bottom: 5px; }
        .p-price { color: var(--gold); font-weight: 900; font-size: 1.2rem; }

        /* Panier Royal */
        .royal-cart { 
            background: var(--card); border-radius: 30px; padding: 30px; 
            border: 1px solid rgba(251, 191, 36, 0.1); height: fit-content;
            position: sticky; top: 20px;
        }
        .cart-scroll { max-height: 350px; overflow-y: auto; margin: 20px 0; }
        .cart-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* Boutons Paiement */
        .pay-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .pay-btn { padding: 15px; border: none; border-radius: 16px; color: white; font-weight: 800; cursor: pointer; font-size: 11px; text-transform: uppercase; }

        /* Pages & Admin */
        .page { display: none; animation: slideUp 0.4s ease; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; } }
        .form-card { background: var(--card); padding: 25px; border-radius: 24px; margin-bottom: 20px; }
        input { width: 100%; padding: 16px; background: #0f172a; border: 1px solid #334155; border-radius: 12px; color: white; margin-top: 10px; outline: none; }
        .gold-btn { width: 100%; padding: 18px; background: var(--gradient); border: none; border-radius: 15px; color: #000; font-weight: 900; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

<div id="lockScreen">
    <div class="lock-box">
        <i class="fas fa-crown" style="font-size: 50px; color: var(--gold);"></i>
        <h2 style="margin: 20px 0;">ESSAI TERMIN√â</h2>
        <p style="color: var(--muted); margin-bottom: 25px;">Activez votre licence pour continuer √† r√©gner sur votre business.</p>
        <input type="text" id="royalKey" placeholder="DIGIY-PRO-XXXX">
        <button class="gold-btn" onclick="activate()">D√âBLOQUER LA MAJEST√â</button>
    </div>
</div>

<div class="header">
    <div class="brand">
        <div class="crown-icon"><i class="fas fa-eagle"></i></div>
        <div>
            <h2 id="storeDisp">BOUTIQUE</h2>
            <div id="trialBadge"></div>
        </div>
    </div>
    <div style="text-align: right;">
        <span style="color: var(--gold); font-weight: 900; font-size: 11px; letter-spacing: 1px;">EDITION ROYAL v2026</span>
    </div>
</div>

<div class="nav-elite">
    <div class="nav-link active" onclick="tab('pos', this)"><i class="fas fa-gem"></i> BOUTIQUE</div>
    <div class="nav-link" onclick="tab('history', this)"><i class="fas fa-vault"></i> ARCHIVES</div>
    <div class="nav-link" onclick="tab('admin', this)"><i class="fas fa-crown"></i> GESTION</div>
</div>

<div id="posPage" class="page active">
    <div class="main-container">
        <div id="productsGrid" class="products-listing"></div>
        <div class="royal-cart">
            <h3 style="letter-spacing: 2px; color: var(--muted); font-size: 14px;">COMMANDES ROYAL</h3>
            <div id="cartListing" class="cart-scroll"></div>
            <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--gold); padding-top: 20px;">
                <span style="font-weight: 800;">TOTAL</span>
                <h2 id="totalPrice" style="color: var(--gold); font-size: 2.2rem;">0 F</h2>
            </div>
            <div class="pay-grid" style="margin-top: 25px;">
                <button class="pay-btn" style="background: #10b981;" onclick="checkout('CASH')">Esp√®ces</button>
                <button class="pay-btn" style="background: #0ea5e9;" onclick="checkout('WAVE')">Wave</button>
                <button class="pay-btn" style="background: #f97316;" onclick="checkout('OM')">Orange</button>
                <button class="pay-btn" style="background: #8b5cf6;" onclick="checkout('CB')">Carte</button>
                <button class="pay-btn" style="background: #64748b;" onclick="checkout('CHQ')">Ch√®que</button>
                <button class="pay-btn" style="background: #ef4444;" onclick="checkout('CREDIT')">Cr√©dit</button>
            </div>
        </div>
    </div>
</div>

<div id="historyPage" class="page">
    <div class="main-container" style="display: block; max-width: 800px; margin: auto;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <div class="form-card" style="text-align: center; border-left: 5px solid #10b981;">
                <small>REVENUS DU JOUR</small>
                <h2 id="revDay" style="color: #10b981; font-size: 2rem;">0 F</h2>
            </div>
            <div class="form-card" style="text-align: center; border-left: 5px solid #ef4444;">
                <small>CR√âDITS √Ä R√âCUP√âRER</small>
                <h2 id="debtDay" style="color: #ef4444; font-size: 2rem;">0 F</h2>
            </div>
        </div>
        <h3>Dettes Nobles √† Solder</h3>
        <div id="debtListing" style="margin-top: 20px;"></div>
    </div>
</div>

<div id="adminPage" class="page">
    <div class="main-container" style="display: block; max-width: 600px; margin: auto;">
        <div class="form-card" id="activationCard" style="border: 1px dashed var(--gold);">
            <h3 style="color:var(--gold)">üîë D√âBLOQUER LA PUISSANCE</h3>
            <input type="text" id="adminKey" placeholder="Cl√© de licence">
            <button class="gold-btn" onclick="activate('adminKey')">ACTIVER VERSION ELITE</button>
        </div>
        <div class="form-card">
            <h3>üì¶ NOUVEL ARTICLE</h3>
            <input type="text" id="addName" placeholder="Nom">
            <input type="number" id="addPrice" placeholder="Prix">
            <input type="number" id="addStock" placeholder="Stock">
            <button class="gold-btn" onclick="addNew()">AJOUTER AU CATALOGUE</button>
        </div>
        <div class="form-card">
            <h3>üè¶ CONFIGURATION BOUTIQUE</h3>
            <input type="text" id="setStore" placeholder="Nom Boutique">
            <button class="gold-btn" onclick="saveStore()">ENREGISTRER</button>
        </div>
    </div>
</div>

<script>
// --- DONN√âES ---
const TRIAL_LIMIT = 15;
let db = {
    pro: localStorage.getItem('elite_active') === 'true',
    start: localStorage.getItem('elite_start') || Date.now(),
    name: localStorage.getItem('elite_name') || "MA BOUTIQUE ELITE",
    items: JSON.parse(localStorage.getItem('elite_items')) || [
        {id: 1, name: "Article Royal", price: 1000, stock: 100}
    ],
    sales: JSON.parse(localStorage.getItem('elite_sales')) || [],
    cart: []
};
if(!localStorage.getItem('elite_start')) localStorage.setItem('elite_start', db.start);

// --- NAVIGATION ---
function tab(id, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
    document.getElementById(id+'Page').classList.add('active');
    btn.classList.add('active');
    render();
}

// --- RENDER ---
function render() {
    const diff = Date.now() - parseInt(db.start);
    const passed = Math.floor(diff / (1000 * 60 * 60 * 24));
    const left = Math.max(0, TRIAL_LIMIT - passed);
    
    if(!db.pro && left <= 0) document.getElementById('lockScreen').style.display = 'flex';
    
    document.getElementById('storeDisp').innerText = db.name;
    document.getElementById('trialBadge').innerHTML = db.pro ? 
        '<span style="color:var(--gold); font-size:10px; font-weight:bold;">üëë LICENCE ELITE</span>' : 
        `<span style="background:var(--gold); color:black; padding:2px 8px; border-radius:10px; font-size:10px; font-weight:bold;">ESSAI : ${left} JOURS RESTANTS</span>`;

    if(db.pro && document.getElementById('activationCard')) document.getElementById('activationCard').style.display = 'none';

    // Produits
    document.getElementById('productsGrid').innerHTML = db.items.map(p => `
        <div class="noble-card" onclick="addToCart(${p.id})">
            <i class="fas fa-gem"></i>
            <div class="p-name">${p.name}</div>
            <div class="p-price">${p.price.toLocaleString()} F</div>
            <div style="font-size:10px; color:var(--muted); margin-top:10px;">STOCK : ${p.stock}</div>
        </div>
    `).join('');

    // Panier
    document.getElementById('cartListing').innerHTML = db.cart.map(i => `
        <div class="cart-row"><span>${i.name} x${i.qty}</span><span>${(i.price*i.qty).toLocaleString()} F</span></div>
    `).join('');
    const total = db.cart.reduce((s,i) => s + (i.price*i.qty), 0);
    document.getElementById('totalPrice').innerText = total.toLocaleString() + " F";

    // Archives
    const today = new Date().toLocaleDateString();
    const todaySales = db.sales.filter(s => new Date(s.id).toLocaleDateString() === today);
    document.getElementById('revDay').innerText = todaySales.reduce((s,x) => s+x.total, 0).toLocaleString() + " F";
    
    const unpaid = db.sales.filter(s => s.status === 'DUE');
    document.getElementById('debtDay').innerText = unpaid.reduce((s,x) => s+x.total, 0).toLocaleString() + " F";
    document.getElementById('debtListing').innerHTML = unpaid.map(u => `
        <div class="form-card" style="display:flex; justify-content:space-between; align-items:center;">
            <div><b>VENTE #${u.id.toString().slice(-4)}</b><br><small>${u.total} F</small></div>
            <button onclick="settle(${u.id})" style="padding:10px 20px; background:#10b981; border:none; border-radius:10px; color:white; font-weight:bold; cursor:pointer;">SOLDER</button>
        </div>
    `).join('');
}

// --- ACTIONS ---
function addToCart(id) {
    const p = db.items.find(x => x.id === id);
    if(p.stock <= 0) return alert("Rupture de stock !");
    const inCart = db.cart.find(x => x.id === id);
    if(inCart) inCart.qty++; else db.cart.push({...p, qty: 1});
    render();
}

function checkout(m) {
    if(db.cart.length === 0) return;
    const total = db.cart.reduce((s,i) => s + (i.price*i.qty), 0);
    const sale = { id: Date.now(), total, method: m, status: m==='CREDIT' ? 'DUE' : 'PAID' };
    
    db.cart.forEach(i => { db.items.find(p => p.id === i.id).stock -= i.qty; });
    db.sales.push(sale);
    const currentCart = [...db.cart];
    db.cart = [];
    save();
    render();
    printTicket(sale, currentCart);
    alert("Transaction Royal Valid√©e !");
}

function printTicket(sale, items) {
    const ticket = window.open('', 'PRINT', 'height=600,width=400');
    ticket.document.write(`<html><body style="font-family:monospace;width:80mm;padding:5mm;">
        <h2 style="text-align:center;">ü¶Ö ${db.name}</h2>
        <hr>${items.map(i => `<p>${i.name} x${i.qty} : ${(i.price*i.qty)} F</p>`).join('')}
        <hr><h3 style="display:flex;justify-content:space-between;"><span>TOTAL</span><span>${sale.total} F</span></h3>
        <p style="text-align:center;font-size:10px;margin-top:20px;">${new Date(sale.id).toLocaleString()}<br>DIGIY POS ELITE</p>
    </body></html>`);
    ticket.document.close();
    ticket.print();
    ticket.close();
}

function addNew() {
    const n = document.getElementById('addName').value;
    const p = parseInt(document.getElementById('addPrice').value);
    const s = parseInt(document.getElementById('addStock').value);
    if(n && p) {
        db.items.push({id: Date.now(), name: n, price: p, stock: s});
        save(); render();
        alert("Article ajout√© !");
    }
}

function saveStore() {
    db.name = document.getElementById('setStore').value;
    localStorage.setItem('elite_name', db.name);
    render();
}

function settle(id) {
    db.sales.find(s => s.id === id).status = 'PAID';
    save(); render();
}

function activate(id = 'royalKey') {
    if(document.getElementById(id).value === "DIGIY-PRO-2026") {
        localStorage.setItem('elite_active', 'true');
        location.reload();
    } else alert("Cl√© invalide.");
}

function save() {
    localStorage.setItem('elite_items', JSON.stringify(db.items));
    localStorage.setItem('elite_sales', JSON.stringify(db.sales));
}

render();
</script>
</body>
</html>

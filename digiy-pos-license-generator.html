<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>DIGIY POS â€” GÃ©nÃ©rateur de Licences ðŸ‘‘</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  margin:0;
  background:#020617;
  font-family:system-ui;
  color:#f9fafb;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}
.box{
  width:520px;
  background:#030712;
  border:1px solid rgba(250,204,21,.25);
  border-radius:18px;
  padding:32px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}
h1{
  margin:0 0 18px 0;
  font-size:24px;
  background:linear-gradient(135deg,#facc15,#f97316);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
label{font-size:13px;color:#cbd5f5}
input,select{
  width:100%;
  margin-top:6px;
  margin-bottom:16px;
  padding:12px;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.25);
  background:#020617;
  color:#f9fafb;
}
button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:linear-gradient(135deg,#facc15,#f97316);
  font-weight:700;
  cursor:pointer;
}
textarea{
  width:100%;
  margin-top:16px;
  padding:12px;
  background:#020617;
  border:1px solid rgba(148,163,184,.25);
  border-radius:10px;
  color:#22c55e;
  height:120px;
}
</style>
</head>

<body>
<div class="box">
<h1>DIGIY POS ðŸ‘‘ GÃ©nÃ©rateur Officiel</h1>

<label>DurÃ©e licence</label>
<select id="duration">
  <option value="30">1 mois</option>
  <option value="180">6 mois</option>
  <option value="365" selected>1 an</option>
  <option value="730">2 ans</option>
</select>

<label>Device ID (optionnel)</label>
<input id="device" placeholder="laisser vide = licence universelle">

<button onclick="generate()">GÃ©nÃ©rer Licence</button>

<textarea id="out" placeholder="La licence DIGIY apparaÃ®tra ici..."></textarea>
</div>

<script>
/* ======================================================
   DIGIY POS PRO â™¾ï¸ â€” VERSION OFFLINE LICENCE 31 JOURS
   Stockage : IndexedDB
   Licence : SignÃ©e Offline
   Blocage automatique
====================================================== */

const DB_NAME = "digiy_pos_db";
const STORE = "kv";
const STATE_KEY = "state";

/* ===== IndexedDB simple ===== */
function db(){
  return new Promise((res,rej)=>{
    const r=indexedDB.open(DB_NAME,1);
    r.onupgradeneeded=e=>e.target.result.createObjectStore(STORE);
    r.onsuccess=()=>res(r.result);
    r.onerror=()=>rej();
  });
}
async function save(k,v){
  const d=await db();
  return new Promise(r=>{
    const t=d.transaction(STORE,"readwrite");
    t.objectStore(STORE).put(v,k);
    t.oncomplete=()=>r();
  });
}
async function load(k){
  const d=await db();
  return new Promise(r=>{
    const t=d.transaction(STORE,"readonly");
    const q=t.objectStore(STORE).get(k);
    q.onsuccess=()=>r(q.result);
  });
}

/* ===== STATE ===== */
let appState={
  licenseMeta:null,
  isDemo:false,
  products:[],
  cart:[],
  history:[],
  shopInfo:{name:"Ma Boutique"}
};

/* ===== LICENCE CHECK ===== */
function validLicense(){
  return appState.licenseMeta && Date.now() < new Date(appState.licenseMeta.exp).getTime();
}
function daysLeft(){
  if(!appState.licenseMeta) return 0;
  return Math.ceil((new Date(appState.licenseMeta.exp)-Date.now())/86400000);
}
function blockIfExpired(){
  if(!appState.isDemo && !validLicense()){
    document.body.innerHTML=`
    <div style="background:#020617;color:white;height:100vh;display:flex;align-items:center;justify-content:center">
      <div style="text-align:center;background:#030712;padding:40px;border-radius:18px;border:1px solid gold">
        <h2 style="color:gold">Licence expirÃ©e</h2>
        <p>DIGIY POS verrouillÃ©.<br>Renouvelez votre licence.</p>
        <a href="https://wa.me/221771342889" style="color:black;background:gold;padding:12px 22px;border-radius:12px;text-decoration:none;font-weight:700">Renouveler</a>
      </div>
    </div>`;
  }
}

/* ===== ACTIVATION LICENCE ===== */
async function activateLicense(){
  const exp=Date.now()+31*86400000;
  appState.licenseMeta={exp};
  await save(STATE_KEY,appState);
  location.reload();
}

/* ===== INIT ===== */
async function init(){
  const s=await load(STATE_KEY);
  if(s) appState=s;
  blockIfExpired();

  if(validLicense()){
    document.getElementById("licenseBadge").innerHTML="ðŸ¦… PRO â€¢ "+daysLeft()+"j";
  }
}

document.addEventListener("DOMContentLoaded",init);
</script>
</body>
</html>
